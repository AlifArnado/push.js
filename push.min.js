(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={isUndefined:function isUndefined(obj){return obj===undefined},isString:function isString(obj){return typeof obj==="string"},isFunction:function isFunction(obj){return obj&&{}.toString.call(obj)==="[object Function]"}}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _messages=require("./messages");var _messages2=_interopRequireDefault(_messages);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Permission=function(){function Permission(win,doc){_classCallCheck(this,Permission);this._win=win;this._doc=doc;this.DEFAULT="default";this.GRANTED="granted";this.DENIED="denied";this._permissions=[this.DEFAULT,this.GRANTED,this.DENIED]}_createClass(Permission,[{key:"request",value:function request(onGranted,onDenied){var _this=this;var existing=this.get();callback=function callback(result){switch(result){case _this.GRANTED:if(onGranted)onGranted();break;case _this.DENIED:if(onDenied)onDenied();break}};if(existing!==this.DEFAULT)callback(existing);else if(this._win.Notification&&this._win.Notification.requestPermission)this._win.Notification.requestPermission(callback);else if(this._win.webkitNotifications&&this._win.webkitNotifications.checkPermission)this._win.webkitNotifications.requestPermission(callback);else throw new Error(_messages2.default.errors.incompatible)}},{key:"has",value:function has(){return this.get()===this.GRANTED}},{key:"get",value:function get(){var permission=void 0;if(this._win.Notification&&this._win.Notification.permissionLevel)permission=this._win.Notification.permissionLevel;else if(this._win.webkitNotifications&&this._win.webkitNotifications.checkPermission)permission=this._permissions[this._win.webkitNotifications.checkPermission()];else if(this._win.Notification&&this._win.Notification.permission)permission=this._win.Notification.permission;else if(navigator.mozNotification)permission=this.GRANTED;else if(this._win.external&&this._win.external.msIsSiteMode()!==undefined)permission=this._win.external.msIsSiteMode()?this.GRANTED:this.DEFAULT;else throw new Error(_messages2.default.errors.incompatible);return permission}}]);return Permission}();exports.default=Permission},{"./messages":4}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Helpers=require("./Helpers");var _Helpers2=_interopRequireDefault(_Helpers);var _Permission=require("./Permission");var _Permission2=_interopRequireDefault(_Permission);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Push=function(){function Push(win,doc){_classCallCheck(this,Push);this._currentId=0;this._notifications={};this._lastWorkerPath=null;this._win=win;this._doc=doc;this.Permission=new _Permission2.default(win,doc)}_createClass(Push,[{key:"_closeNotification",value:function _closeNotification(id){var errored=false;var notification=this._notifications[id];if(typeof notification!=="undefined"){if(notification.close)notification.close();else if(notification.cancel)notification.cancel();else if(this._win.external&&this._win.external.msIsSiteMode)this._win.external.msSiteModeClearIconOverlay();else{errored=true;throw new Error("Unable to close notification: unknown interface")}if(!errored){return this._removeNotification(id)}}return false}},{key:"_addNotification",value:function _addNotification(notification){var id=currentId;this._notifications[id]=notification;this._currentId++;return id}},{key:"_removeNotification",value:function _removeNotification(id){var dict={};var success=false;var key=void 0;for(key in this._notifications){if(this._notifications.hasOwnProperty(key)){if(key!=id){dict[key]=this._notifications[key]}else{success=true}}}this._notifications=dict;return success}},{key:"_prepareNotification",value:function _prepareNotification(id,options){var wrapper=void 0;wrapper={get:function get(){return this._notifications[id]},close:function close(){this._closeNotification(id)}};if(options.timeout){setTimeout(function(){wrapper.close()},options.timeout)}return wrapper}},{key:"_createCallback",value:function _createCallback(title,options,resolve){var _this=this;var notification=void 0;var onClose=void 0;options=options||{};this._lastWorkerPath=options.serviceWorker||"serviceWorker.js";onClose=function onClose(id){this._removeNotification(id);if(isFunction(options.onClose)){options.onClose.call(this,notification)}};if(this._win.Notification){try{notification=new this._win.Notification(title,{icon:_Helpers2.default.isString(options.icon)||_Helpers2.default.isUndefined(options.icon)?options.icon:options.icon.x32,body:options.body,tag:options.tag,requireInteraction:options.requireInteraction})}catch(e){if(this._win.navigator){this._win.navigator.serviceWorker.register(this._lastWorkerPath);this._win.navigator.serviceWorker.ready.then(function(registration){var localData={id:_this._currentId,link:options.link,origin:document.location.href,onClick:_Helpers2.default.isFunction(options.onClick)?options.onClick.toString():"",onClose:_Helpers2.default.isFunction(options.onClose)?options.onClose.toString():""};if(typeof options.data!=="undefined"&&options.data!==null)localData=Object.assign(localData,options.data);registration.showNotification(title,{icon:options.icon,body:options.body,vibrate:options.vibrate,tag:options.tag,data:localData,requireInteraction:options.requireInteraction}).then(function(){var id=void 0;registration.getNotifications().then(function(notifications){id=_this._addNotification(notifications[notifications.length-1]);registration.active.postMessage("");navigator.serviceWorker.addEventListener("message",function(event){var data=JSON.parse(event.data);if(data.action==="close"&&Number.isInteger(data.id))_this._removeNotification(data.id)});resolve(_this._prepareNotification(id,options))})})})}}}else if(this._win.webkitNotifications){notification=this._win.webkitNotifications.createNotification(options.icon,title,options.body);notification.show()}else if(navigator.mozNotification){notification=navigator.mozNotification.createNotification(title,options.body,options.icon);notification.show()}else if(this._win.external&&this._win.external.msIsSiteMode()){this._win.external.msSiteModeClearIconOverlay();this._win.external.msSiteModeSetIconOverlay(_Helpers2.default.isString(options.icon)||_Helpers2.default.isUndefined(options.icon)?options.icon:options.icon.x16,title);this._win.external.msSiteModeActivate();notification={}}else{throw new Error("Unable to create notification: unknown interface")}if(typeof notification!=="undefined"){(function(){var id=_this._addNotification(notification);var wrapper=_this._prepareNotification(id,options);if(isFunction(options.onShow))notification.addEventListener("show",options.onShow);if(isFunction(options.onError))notification.addEventListener("error",options.onError);if(isFunction(options.onClick))notification.addEventListener("click",options.onClick);notification.addEventListener("close",function(){onClose(id)});notification.addEventListener("cancel",function(){onClose(id)});resolve(wrapper)})()}resolve({})}},{key:"_lastWorkerPath",value:function _lastWorkerPath(){return self._lastWorkerPath}},{key:"create",value:function create(title,options){var promiseCallback=void 0;if(!_Helpers2.default.isString(title)){throw new Error("PushError: Title of notification must be a string")}if(!this.Permission.has()){promiseCallback=function promiseCallback(resolve,reject){self.Permission.request(function(){try{createCallback(title,options,resolve)}catch(e){reject(e)}},function(){reject("Permission request declined")})}}else{promiseCallback=function promiseCallback(resolve,reject){try{createCallback(title,options,resolve)}catch(e){reject(e)}}}return new Promise(promiseCallback)}},{key:"count",value:function count(){var count=0;var key=void 0;for(key in this._notifications){count++}return count}},{key:"close",value:function close(tag){var key=void 0,notification=void 0;for(key in this._notifications){notification=this._notifications[key];if(notification.tag===tag){return this._closeNotification(key)}}}},{key:"clear",value:function clear(){var key=void 0,success=true;for(key in this._notifications){success=success&&this._closeNotification(key)}return success}}]);return Push}();exports.default=Push},{"./Helpers":1,"./Permission":2}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errorPrefix="PushError:";exports.default={errors:{incompatible:"${errorPrefix} Push.js is incompatible with browser."}}},{}],5:[function(require,module,exports){"use strict";var _Push=require("./classes/Push");var _Push2=_interopRequireDefault(_Push);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(function(global,factory){if(typeof define==="function"&&define.amd){define(function(){return new(factory(global,global.document))})}else if(typeof module!=="undefined"&&module.exports){module.exports=new(factory(global,global.document))}else{global.Push=new(factory(global,global.document))}})(typeof window!=="undefined"?window:undefined,function(w,d){return new _Push2.default(w,d)})},{"./classes/Push":3}]},{},[5]);
